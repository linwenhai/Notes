## 异常



### 1 try-except结构

```
跳过try 块中异常以后的代码
try:
	被监控的可能引发异常的语句块
except BaseException [as e]:
	异常处理语句块
```

```python
#跳过try块中异常以后的代码
try:
    print("step1")
    a = 3/0
    print("step2")
except BaseException as e:
    print("step3")
    print(e)
print("step4")
```

执行结果：

```
step1
step3
division by zero
step4
```



```python
#无异常，跳过except异常处理块
try:
    print("step1")
    a = 3/2
    print("step2")
except BaseException as e:
    print("step3")
    print(e)
print("step4")
```

执行结果:

```
step1
step2
step4
```



```python
#循环输入数字，如果不是数字则处理异常；直到输入88，则结束循环
while True:
    try:
        x = int(input("请输入一个数字："))
        print("你输入的数字是",x)
        if x == 88:
            print("退出程序")
            break
    except:
        print("异常，输入不是数字")
```

执行结果：

```
请输入一个数字：33
你输入的数字是 33
请输入一个数字：12
你输入的数字是 12
请输入一个数字：dd
异常，输入不是数字
请输入一个数字：88
你输入的数字是 88
退出程序
```





### 2 try-多个except结构

```
try:
	被监控的、可能引发异常的语句块
except Exception1:
	处理Exception1 的语句块
except Exception2:
	处理Exception2 的语句块
...
except BaseException：
	处理可能遗漏的异常的语句块
```



```python
try:
    a = input("请输入被除数：")
    b = input("请输入除数")
    c = float(a)/float(b)
    print(c)
except ZeroDivisionError:
    print("异常：除数不能为0")
except TypeError:
    print("异常：除数和被除数都应该为数值类型")
except NameError:
    print("异常：变量不存在")
except BaseException as e:
    print(e)
    print(type(e))
```

执行结果：

```
请输入被除数：10
请输入除数0
异常：除数不能为0
```



### 3 try-except-else结果

```python
#如try块中没有抛出异常，则执行else块；如try块中抛出异常，则执行except块，不执行else块
try:
    a = input("请输入被除数：")
    b = input("请输入除数：")
    c = float(a)/float(b)
except BaseException as e:
    print(e)
else:
    print("除的结果是：",c)
```



### 4 try-except-finally结构

```python
#finally块无论是否发生异常都会被执行；通常用来释放try块中申请的资源。
try:
    a = input("请输入被除数：")
    b = input("请输入除数：")
    c = float(a)/float(b)
except BaseException as e:
    print(e)
else:
    print(c)
finally:
    print("无论异常是否都执行")
print("程序结束")
```



### 5 return 语句和异常处理问题

```python
#一般不把return 放到异常处理结构中，而是放到方法最后
def test01():
    print("step1")
    try:
        x = 3/0
    except:
        print("step2")
        print("异常：0不能做除数")
    finally:
        print("step3")
    print("step4")
    return "e"
print(test01())
```



### 6 常见异常的解决

| 错误代码                  | 描述                                               |
| ------------------------- | -------------------------------------------------- |
| SyntaxError               | 语法错误                                           |
| NameError                 | 尝试访问一个没有申明的变量                         |
| ZeroDivisionError         | 零除错误                                           |
| ValueError                | 数值错误                                           |
| TypeError                 | 类型错误                                           |
| AttributeError            | 访问对象的不存在的属性                             |
| IndexError                | 索引越界异常                                       |
| KeyError                  | 字典的关键字不存在                                 |
| ArithmeticError           | 所有数值计算错误的基类                             |
| AssertionError            | 断言语句失败                                       |
| BaseException             | 所有异常的基类                                     |
| DeprecationWarning        | 关于被弃用的特征的警告                             |
| EnvironmentError          | 操作系统错误的基类                                 |
| EOFError                  | 没有内建输入,到达EOF 标记                          |
| Exception                 | 常规错误的基类                                     |
| FloatingPointError        | 浮点计算错误                                       |
| FutureWarning             | 关于构造将来语义会有改变的警告                     |
| GeneratorExit             | 生成器(generator)发生异常来通知退出                |
| ImportError               | 导入模块/对象失败                                  |
| IndentationError          | 缩进错误                                           |
| IndexError                | 序列中没有此索引(index)                            |
| IOError                   | 输入/输出操作失败                                  |
| KeyboardInterrupt         | 用户中断执行(通常是输入^C)                         |
| LookupError               | 无效数据查询的基类                                 |
| MemoryError               | 内存溢出错误                                       |
| NotImplementedError       | 尚未实现的方法                                     |
| OSError                   | 操作系统错误                                       |
| OverflowError             | 数值运算超出最大限制                               |
| OverflowWarning           | 旧的关于自动提升为长整型(long)的警告               |
| PendingDeprecationWarning | 关于特性将会被废弃的警告                           |
| ReferenceError            | 弱引用(Weak reference)试图访问已经垃圾回收了的对象 |
| RuntimeError              | 一般的运行时错误                                   |
| RuntimeWarning            | 可疑的运行时行为(runtime behavior)的警告           |
| StandardError             | 所有的内建标准异常的基类                           |
| StopIteration             | 迭代器没有更多的值                                 |
| SyntaxWarning             | 可疑的语法的警告                                   |
| SystemExit                | 解释器请求退出                                     |
| TabError                  | Tab 和空格混用                                     |
| UnboundLocalError         | 访问未初始化的本地变量                             |
| UnicodeDecodeError        | Unicode 解码时的错误                               |
| UnicodeEncodeError        | Unicode 编码时错误                                 |
| UnicodeError              | Unicode 相关的错误                                 |
| UnicodeTranslateError     | Unicode 转换时错误                                 |
| UserWarning               | 用户代码生成的警告                                 |
| Warning                   | 警告的基类                                         |
| WindowsError              | 系统调用失败                                       |



### 7 with 上下文管理

with 上下文管理可以自动管理资源，在with 代码块执行完毕后自动还原进入该代码之前的现场或上下文。

```python
with open("e:/1.log") as f:
    for line in f:
        print(line)
```



### 8 Traceback 模块

```python
#使用Traceback模块打印异常信息
import traceback
try:
    print("step1")
    num = 1/0
except:
    traceback.print_exc()
```



```python
#使用traceback将异常信息写入日志文件
import traceback
try:
    print("step1")
    num = 1/0
except:
    with open("e:/a.log","a") as f:
        traceback.print_exc(file=f)
```



### 9 自定义异常类

一般以Error、Exception 为后缀。

```python
class AgeError(Exception):
    """继承Exception"""
    def __init__(self,errorInfo):
        Exception.__init__(self)
        self.errorInfo = errorInfo
    def __str__(self):
        return str(self.errorInfo)+" 输入年龄错误，请重新输入"

if __name__ == "__main__":
    age = int(input("输入一个年龄："))
    if age<1 or age>150:
        raise AgeError(age)
    else:
        print("正确的年龄：",age)
```

执行结果：

```
输入一个年龄：200
Traceback (most recent call last):
  File "D:/技术/CODE/lin_00_test.py", line 12, in <module>
    raise AgeError(age)
__main__.AgeError: 200 输入年龄错误，请重新输入
```















