## 测试代码

Python标准库中的模块unittest提供了代码测试工具。



### 1 测试函数

1】模块name_function.py，包含一个函数

```python
def get_formatted_name(first,last):
    """接受名和姓并返回整洁的姓名"""
    full_name = first + ' ' + last
    return full_name.title()
```



2】模块name_ function_test.py，测试函数

```python
import unittest
from name_function import get_formatted_name

class NameTestCase(unittest.TestCase):
    """测试name_function.py"""
    def test_first_last_name(self):
        """"""
        formatted_name = get_formatted_name('lin','wenhai')
        self.assertEqual(formatted_name,'Lin Wenhai')

if __name__ == '__main__':
    unittest.main()
```

>输出结果：
>
>Ran 1 test in 0.006s
>
>OK



类名不要用`test_`开头的，以`test_`打头的方法都将自动运行。

self.assertEqual()：断言方法用来核实得到的结果是否与期望的结果一致。

使用unittest时，所有函数必须以test开头。

测试未通过时，不要修改测试，而应修复导致测试不能通过的代码：检查刚对函数所做的修改，找出导致函数行为不符合预期的修改。



### 2 函数添加新测试

1】模块name_function.py

```python
def get_formatted_name(first,last,middle=''):
    """Generate a neatly formatted full name."""
    if middle:
        full_name = first + ' ' + middle + ' ' + last
    else:
        full_name = first + ' ' + last
    return full_name.title()
```

2】模块name_ function_test.py

```python
import unittest
from name_function import get_formatted_name

class NameTestCase(unittest.TestCase):
    """测试name_function.py"""
    def test_first_last_name(self):
        formatted_name = get_formatted_name('xin','ling')
        self.assertEqual(formatted_name,'Xin Ling')

    def test_first_middle_last_name(self):
        formatted_name = get_formatted_name('lin','hai','wen')
        self.assertEqual(formatted_name,'Lin Wen Hai')

if __name__ == '__main__':
    unittest.main()
```





### 3 各种断言方法

| 方法                    | 用途               |
| ----------------------- | ------------------ |
| assertEqual(a, b)       | 核实a == b         |
| assertNotEqual(a, b)    | 核实a != b         |
| assertTrue(x)           | 核实x为True        |
| assertFalse(x)          | 核实x为False       |
| assertIn(item, list)    | 核实item在list中   |
| assertNotIn(item, list) | 核实item不在list中 |



### 4 测试类

1】模块survey.py，包含一个类。

```python
class AnonymousSurvey():
    """收集匿名调查问卷"""
    def __init__(self,question):
        self.question = question
        self.responses = []

    def show_question(self):
        print(question)

    def stored_response(self,new_response):
        self.responses.append(new_response)

    def show_results(self):
        print("Survey results:")
        for response in responses:
            print('_' + response)
```



2】模块survey_test.py，测试类。

```python
import unittest
from survey import AnonymousSurvey

class AnonymousSurveyTest(unittest.TestCase):
    """针对AnonymousSurvey类的测试"""
    def test_store_single_response(self):
        question = "What language did you first learn to speak?"
        my_survey = AnonymousSurvey(question)
        """创建my_survey实例"""
        my_survey.stored_response('English')

        self.assertIn('English',my_survey.responses)

if __name__ == '__main__':
    unittest.main()
```



3】改进型

```python
import unittest
from survey import AnonymousSurvey

class AnonymousSurveyTest(unittest.TestCase):
    """针对AnonymousSurvey类的测试"""
    def test_store_single_response(self):
        question = "What language did you first learn to speak?"
        my_survey = AnonymousSurvey(question)
        my_survey.stored_response('English')
        self.assertIn('English',my_survey.responses)

    def test_store_three_response(self):
        """测试三个答案会被妥善地存储"""
        question = "What language did you first learn to speak?"
        my_survey = AnonymousSurvey(question)
        responses = ['English', 'Spanish', 'Mandarin']
        for response in responses:
            my_survey.stored_response(response)
            self.assertIn(response,my_survey.responses)

if __name__ == '__main__':
    unittest.main()
```



### 5 方法setUp()

如果你在TestCase类中包含了方法setUp()，Python将先运行它，再运行各个以test_打头的方法。

```python
import unittest
from survey import AnonymousSurvey

class AnonymousSurveyTest(unittest.TestCase):
    """针对AnonymousSurvey类的测试"""

    def setUp(self):
        """创建一个调查对象和一组答案"""
        question = "What language did you first learn to speak?"
        self.my_survey = AnonymousSurvey(question)
        self.responses = ['English', 'Spanish', 'Mandarin']

    def test_store_single_response(self):
        """测试单个答案会被妥善地存储"""
        self.my_survey.stored_response(self.responses[0])
        self.assertIn(self.responses[0],self.my_survey.responses)

    def test_store_three_response(self):
        """测试三个答案会被妥善地存储"""
        for response in self.responses:
            self.my_survey.stored_response(response)
            self.assertIn(response,self.my_survey.responses)

if __name__ == '__main__':
    unittest.main()
```

