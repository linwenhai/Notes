## 迭代器Iterator

迭代器是一个可以记住遍历的位置的对象。

迭代器对象从集合的第一个元素开始访问，直到所有的元素被访问完结束。

迭代器只能往前不会后退。

### 1 可迭代对象

可以通过for...in...这类语句迭代读取一条数据供我们使用的对象称之为可迭代对象（Iterable）。

可以使用 isinstance() 判断一个对象是否是 Iterable 对象

```python
from collections import Iterable
print(isinstance([],Iterable))
print(isinstance({},Iterable))
print(isinstance('abc',Iterable))
print(isinstance(100,Iterable))
```

>执行结果：
>
>True
>True
>True
>False



### 2 迭代器

可迭代对象通过`__iter__`方法向我们提供一个迭代器。

我们在迭代一个可迭代对象的时候，实际上就是先获取该对象提供的一个迭代器，然后通过这个迭代器来依次获取对象中的每一个数据。

一个具备了`__iter__`方法的对象，就是一个可迭代对象。

```python
from collections import Iterable
class Mylist(object):
    def __init__(self):
        self.container=[]
    def add(self,item):
        self.container.append(item)
    def __iter__(self):
        pass
mylist=Mylist()
print(isinstance(mylist,Iterable))
```



### 3 iter()与next()函数

list、tuple等都是可迭代对象，我们可以通过iter()函数获取这些可迭代对象的迭代器。

对获取到的迭代器不断使用next()函数来获取下一条数据。

iter()函数实际上就是调用了可迭代对象的`__iter__`方法。

```python
>>> a=[11,22,33,44,55]
>>> b=iter(a)
>>> next(b)
11
>>> next(b)
22
>>> next(b)
33
>>> next(b)
44
>>> next(b)
55
>>> next(b)
Traceback (most recent call last):
  File "<pyshell#9>", line 1, in <module>
    next(b)
StopIteration
>>> 
```

当已经迭代完最后一个数据之后，再次调用next()函数会抛出StopIteration的异常，表示所有数据都已迭代完成，不用再执行next()函数了。



### 4 迭代器Iterator

一个实现了`__iter__`方法和`__next__`方法的对象，就是迭代器。



### 5 for...in...循环的本质

for **item** in **Iterable** 循环的本质就是先通过iter()函数获取可迭代对象Iterable的迭代器，然后对获取到的迭代器不断调用next()方法来获取下一个值并将其赋值给item，当遇到StopIteration的异常后循环结束。



```python
# 迭代器的应用场景
class Fi(object):
    """斐波那契数列迭代器"""
    def __init__(self,n):
        self.n=n
        self.current=0  # current用来保存当前生成到数列中的第几个数了
        self.num1=0     # num1用来保存前前一个数
        self.num2=1     # num2用来保存前一个数
    def __next__(self):
        if self.current<self.n:
            num=self.num1
            self.num1,self.num2=self.num2,self.num1+self.num2
            self.current+=1
            return num
        else:
            raise StopIteration
    def __iter__(self):
        return self

if __name__=='__main__':
    a=Fi(10)
    for num in a:
        print(num,end=" ")
```

>执行结果：
>0 1 1 2 3 5 8 13 21 34