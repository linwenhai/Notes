## 文件操作

### 1 文本文件和二进制文件

- 文本文件可以使用记事本程序打开。
- 二进制文件把数据内容用“字节”进行存储，无法用记事本打开，如MP4 视频文件、MP3 音频文件、JPG 图片、doc 文档等。

 

### 2 文件操作相关的模块

| 名称                              | 说明                                         |
| --------------------------------- | -------------------------------------------- |
| io 模块                           | 文件流的输入和输出操作 input output          |
| os 模块                           | 基本操作系统功能，包括文件操作               |
| glob 模块                         | 查找符合特定规则的文件路径名                 |
| fnmatch 模块                      | 使用模式来匹配文件路径名                     |
| fileinput 模块                    | 处理多个输入文件                             |
| filecmp 模块                      | 用于文件的比较                               |
| cvs 模块                          | 用于 csv 文件处理                            |
| pickle 和 cPickle                 | 用于序列化和反序列化                         |
| xml 包                            | 用于 XML 数据处理                            |
| bz2、gzip、zipfile、zlib、tarfile | 用于处理压缩和解压缩文件（分别对应不同的算法 |



### 3 编码

![img](D:\Notes\Python\image\20200924232428536.png)



### 4 open()函数

open()函数用于创建文件对象，语法：open(文件名[,打开方式])。

| 打开方式 | 描述                                                         |
| -------- | ------------------------------------------------------------ |
| r        | 读 read 模式                                                 |
| w        | 写 write 模式。如果文件不存在则创建；如果文件存在，则重写新内容； |
| a        | 追加 append 模式。如果文件不存在则创建；如果文件存在，则在文件末尾追加内容 |
| b        | 二进制 binary 模式（可与其他模式组合使用）                   |
| +        | 读、写模式（可与其他模式组合使用）                           |



### 5 文本文件的读写

```python
# 文本写入例子
f=open("a.txt","a")
s="I love duoduo"
f.write(s)
f.close()
```

```python
# 测试中文写入
f=open("a.txt","w",encoding="utf-8")
s="我爱多多"
f.write(s)
f.close()
```



write(a)：把字符串 a 写入到文件中。

writelines(b)：把字符串列表写入文件中，不添加换行符。

```python
# 添加字符串列表数据到文件中
f=open("a.txt","w",encoding="utf-8")
s=["林一\n","林二\n","林三\n"]
f.writelines(s)
f.close()
```

```python
# 使用 with 管理文件写入操作
s=["林一\n","林二\n","林三\n"]
with open("b.txt","w",encoding="utf-8") as f:
    f.writelines(s)
```



read()：读取整个文件，读取到文件末尾，会返回空字符串。

readline()：读取一行内容作为结果返回，读取到文件末尾，会返回空字符串。

readlines()：文本文件中，每一行作为一个字符串存入列表中，返回该列表。

```python
# read()读取整个文件
with open("a.txt","r",encoding="utf-8") as f:
    print(f.read())
```

```python
# readline()按行读取文件
with open("a.txt","r",encoding="utf-8") as f:
    while True:
        a=f.readline()
        if not a:
            break
        else:
            print(a,end="")
```

```python
# 使用迭代器（每次返回一行）读取文本文件
with open("a.txt","r",encoding="utf-8") as f:
    for a in f:
        print(a,end="")
```

```python
# readlines()测试
with open("a.txt","r",encoding="utf-8") as f:
    lines=f.readlines()
    for i in lines:
        print(i,end="")
```



### 6 二进制文件的读写

- f = open("a.txt", 'wb') ：可写的、重写模式的二进制文件对象
- f = open("a.txt", 'ab') ：可写的、追加模式的二进制文件对象
- f = open("a.txt", 'rb') ：可读的二进制文件对象

```python
# 图片复制
with open("1.jpg","rb") as f:
    with open("2.jpg","wb") as w:
        for i in f.readlines():
            w.write(i)
```



### 7 文件指针

tell()：返回文件指针的当前位置。

seek()：把文件指针移动到新的位置。

```python
with open("a.txt","r",encoding="utf-8") as f:
    print("当前指针位置：{0}".format(f.tell()))
    f.readline()
    print("当前指针位置：{0}".format(f.tell()))
    f.seek(0,0)
    print("当前指针位置：{0}".format(f.tell()))
```



### 8 序列化

序列化：指的是将对象转化成“串行化”数据形式，存储到硬盘或通过网络传输到其他地方。

反序列化：是指相反的过程，将读取到的“串行化数据”转化成对象。

pickle 模块中的函数，实现序列化和反序列操作。

- pickle.dump(obj, file) obj 就是要被序列化的对象，file 指的是存储的文件
- pickle.load(file) 从file 读取数据，反序列化成对象

```python
# 将对象序列化到文件中
import pickle
with open("b","wb") as f:
    s1="多多"
    s2=123456
    s3=[10,20]
    pickle.dump(s1,f)
    pickle.dump(s2,f)
    pickle.dump(s3,f)
```

```python
# 将获得的数据反序列化成对象
import pickle
with open("b","rb") as f:
    s1=pickle.load(f)
    s2=pickle.load(f)
    s3=pickle.load(f)
    print(s1)
    print(s2)
    print(s3)
```



### 9 CSV文件操作

csv(Comma Separated Values)是逗号分隔符文本格式。

- csv值没有类型，所有值都是字符串
- csv不能指定字体颜色等样式
- csv不能指定单元格的宽高，不能合并单元格
- csv没有多个工作表
- csv不能嵌入图像图表

```python
# 读取csv内容
import csv
with open("1.csv","r",encoding="utf-8") as f:
    a=csv.reader(f)     #创建csv对象,它是一个包含所有数据的列表
    headers=next(f)
    print(headers)
    for i in a:
        print(i)
```

```python
# 写入csv文件
import csv
headers = ["工号","姓名","年龄","地址","月薪"]
rows = [("1001","林一",18,"南山","50000"),("1002","林二",19,"南山","30000")]
with open("2.csv","w",encoding="utf-8") as f:
    b=csv.writer(f)
    b.writerow(headers)     #写入一行（标题）
    b.writerows(rows)       #写入多行（数据）
```



### 10 os模块

| 函数                     | 描述                                                         |
| ------------------------ | ------------------------------------------------------------ |
| os.name                  | 系统名                                                       |
| os.getcwd()              | 获取当前工作的目录                                           |
| os.listdir(path)         | 列出path目录下所有的文件和目录名。                           |
| os.remove(path)          | 删除path指定的文件                                           |
| os.rmdir(path)           | 删除path指定的目录                                           |
| os.mkdir(path)           | 创建path指定的目录                                           |
| os.path.isfile(path)     | 判断指定对象是否为文件，是返回True，否则False                |
| os.path.isdir(path)      | 判断指定对象是否为目录，是True，否则False                    |
| os.path.exists(path)     | 检验指定的对象是否存在，是True，否则False                    |
| os.path.split(path)      | 返回路径的目录和文件名                                       |
| os.system(cmd)           | 执行shell命令。返回值是脚本的退出状态码，0代表成功，1代表不成功 |
| os.chdir(path)           | 改变目录到指定目录                                           |
| os.path.getsize()        | 获得文件的大小，如果为目录，返回0                            |
| os.path.abspath()        | 获得绝对路径                                                 |
| os.path.join(path, name) | 连接目录和文件名                                             |
| os.path.basename(path)   | 返回文件名                                                   |
| os.path.dirname(path)    | 返回文件路径                                                 |
| walk(top,func,arg)       | 递归方式遍历目录                                             |



### 11 subprocess模块

subprocess.run()函数：

语法：subprocess.run(args[, stdout, stderr, shell ...])

- 若未指定stdout，则命令执行后的结果输出到屏幕上，函数返回值CompletedProcess中包含有args和returncode；
- 若指定有stdout，则命令执行后的结果输出到stdout中，函数返回值CompletedProcess中包含有args、returncode和stdout；
- 若执行成功，则returncode为0；若执行失败，则returncode为1；
- 若想获取args命令执行后的输出结果，命令为：output = subprocess.run(args, stdout=subprocess.PIPE).stdout



```python
"""进程检测"""
import subprocess
def ps(ip):
    command1="ssh -o StrictHostKeyChecking=no {0} 'ps -ef|grep java|grep -v grep'".format(ip)
    output=subprocess.run(command1,shell=True,stdout=subprocess.PIPE).stdout
    out=output.decode()
    if out:
        print("running.....")
    else:
        print(" is not running....")
ps("192.168.1.11")
```

