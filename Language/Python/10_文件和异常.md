## 文件和异常

### 1 读取整个文件

创建文件pi_digits.txt

>3.1415926535
>8979323846
>2643383279



模块file_reader.py

关键字with在不再需要访问文件后将其关闭。

函数open()接受一个参数：要打开的文件的名称，返回一个表示文件的对象。

方法read()：读取这个文件的全部内容，到达文件末尾时返回一个空字符串。

```python
filename = '/app/pi_digits.txt'
with open(filename) as file_object:
	contents = file_object.read()
	print(contents.strip())
```

>输出结果：
>
>3.1415926535
>8979323846
>2643383279



### 2 读取文件，逐行读取

模块file_reader.py

```python
filename = 'pi_digits.txt'
with open(filename) as file_object:
	for line in file_object:
	    print(line.strip())
```



### 3 创建一个包含文件各行内容的列表

方法readlines()：从文件中读取每一行，并将其存储在一个列表中。

```python
filename = 'pi_digits.txt'
with open(filename) as file_object:
	lines = file_object.readlines()
    
pi_string = ''
for line in lines:
	pi_string += line.strip()
    
print(pi_string)
print(len(pi_string))
```

>输出结果：
>
>3.141592653589793238462643383279
>32



```python
# 圆周率值中包含你的生日
filename = 'pi_million_digits.txt'
with open(filename) as file_object:
    lines = file_object.readlines()

pi_string = ''
for line in lines:
    pi_string += line.strip()

birthday = input("Enter your birthday, in the form mmddyy: ")
if birthday in pi_string:
    print("Your birthday appears in the first million digits of pi!")
else:
    print("Your birthday does not appear in the first million digits of pi.")
```



### 4 写入空文件

模块write_message.py

用open()打开文件时，可指定读取模式（'r'）、写入模式（'w'）、附加模式（'a'）或让你能够读取和写入文件的模式（'r+'）。

写入（'w'）模式，如指定的文件已经存在，Python将在返回文件对象前清空该文件；如要写入的文件不存在，函数open()将自动创建它。

方法write()将一个字符串写入文件。

Python只能将字符串写入文本文件。要将数值数据存储到文本文件中，必须先使用函数str()将其转换为字符串格式。

```python
filename = 'programming.txt'
with open(filename, 'w') as file_object:
	file_object.write("I love programming.")
```



```python
filename = 'programming.txt'
with open(filename, 'w') as file_object:
	file_object.write("I love programming.\n")
	file_object.write("I love creating new games.\n")
```

>输出结果：
>
>I love programming.
>I love creating new games.



### 5 附加到文件

```python
filename = 'programming.txt'
with open(filename, 'a') as file_object:
	file_object.write("I also love finding meaning in large datasets.\n")
	file_object.write("I love creating apps that can run in a browser.\n")
```

注意：追加内容需添加换行符。



### 6 处理ZeroDivisionError异常

编写一个try-except代码块来处理可能引发的异常。

```python
try:
	print(5/0)
except ZeroDivisionError:
	print("You can't divide by zero!")
```

>输出结果：
>
>You can't divide by zero!



### 7 使用异常避免崩溃

模块division.py

```python
print("Give me two numbers,and I'll divide them.")
print("Enter 'q' to quit.")

while True:
	first_number = input("\nFirst number: ")
	if first_number == 'q':
		break
	second_number = input("Sencond number: ")
	try:
		answer = int(first_number) / int(second_number)
	except ZeroDivisionError:
		print("You can't divide by 0!")
	else:
		print(answer)
```

>输出结果：
>
>First number: 8
>Sencond number: 0
>You can't divide by 0!
>
>First number: 5
>Sencond number: 2
>2.5



### 8 处理FileNotFoundError异常

```python
filename = 'alice.txt'
try:
	with open(filename) as f_object:
		contents = f_object.read()
except FileNotFoundError:
	print("Sorry, the file " + filename + " does not exist.")
```

>输出结果：
>
>Sorry, the file alice.txt does not exist.



### 9 分析文本

方法`split()`：以空格为分隔符将字符串分拆成多个部分，并将这些部分都存储到一个列表中。

```python
test = "lin wen hai xin ling ling"
print(test.split())
```

>输出结果：
>
>['lin', 'wen', 'hai', 'xin', 'ling', 'ling']





```python
filename = 'pi_million_digits.txt'

try:
	with open(filename) as f_obj:
		contents = f_obj.read()
except FileNotFoundError:
	print("Sorry, the file " + filename + " does not exist.")
else:
	"""计算文件大致包含多少个单词"""
	words = contents.split()
	num_words = len(words)
	print("The file " + filename + " has about " + str(num_words) + " words.")
```



### 10 使用多个文件

```python
def count_words(filename):
	"""计算一个文件包含多少个单词"""
	try:
		with open(filename) as f_obj:
			contents = f_obj.read()
	except FileNotFoundError:
		print("Sorry, the file " + filename + " does not exist.")
	else:
		words = contents.split()
		num_words = len(words)
		print("The file " + filename + " has about " + str(num_words) + " words.")

filenames = ['alice.txt', 'siddhartha.txt', 'moby_dick.txt', 'pi_million_digits.txt']
for filename in filenames:
	count_words(filename)
```

>输出结果：
>
>Sorry, the file alice.txt does not exist.
>Sorry, the file siddhartha.txt does not exist.
>Sorry, the file moby_dick.txt does not exist.
>The file pi_million_digits.txt has about 10000 words.



### 11 失败时一声不吭

pass语句，可在代码块中使用它来让Python什么都不要做。

pass语句还充当了占位符。

```python
def count_words(filename):
	"""计算一个文件大致包含多少个单词"""
	try:
		--snip--
	except FileNotFoundError:
		pass
	else:
		--snip--
        
filenames = ['alice.txt', 'siddhartha.txt', 'moby_dick.txt', 'little_women.txt']
for filename in filenames:
	count_words(filename)
```



### 12 存储数据

一种简单的方式是使用模块json来存储数据。

JSON（JavaScript Object Notation）格式最初是为JavaScript开发的，但随后成了一种常见格式，被包括Python在内的众多语言采用。



### 13 使用json.dump()和json.load()

函数json.dump()接受两个实参：要存储的数据以及可用于存储数据的文件对象。

number_writer.py

```python
# 使用json.dump()来存储1组数字
import json

numbers = [2,3,5,7,11,13]

filename = 'numbers.json'
with open(filename,'w') as f_obj:
	json.dump(numbers,f_obj)
```



number_reader.py

```python
# 使用json.load()将1个列表读取到内存
import json

filename = 'numbers.json'
with open(filename) as f_obj:
	numbers = json.load(f_obj)

print(numbers)
```

>输出结果：
>
>[2, 3, 5, 7, 11, 13]



### 14 保存和读取用户生成的数据

```python
import json

def get_stored_username():
    """如存储了用户，就获取它"""
    filename = 'username.json'
    try:
        with open(filename) as f_obj:
            username = json.load(f_obj)
    except FileNotFoundError:
        return None
    else:
        return username

def get_new_username():
    """提示用户输入用户名"""
    username = input("What is your name?")
    filename = 'username.json'
    with open(filename,'w') as f_obj:
        json.dump(username,f_obj)
        return username

def greet_user():
    """问候用户，并指出其名字"""
    username = get_stored_username()
    if username:
        print("Welcome back, " + username + "!")
    else:
        username = get_new_username()
        print("We'll remember you when you come back, " + username + "!")

greet_user()

```

