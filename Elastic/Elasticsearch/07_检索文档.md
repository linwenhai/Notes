## 检索文档

### 1 _search接口

_search接口可使用PUT或POST方法请求，可指定一个索引、多个索引或星号"*"匹配索引。

#### 1.1 基于URI

```json
# 匹配字段message包含chrome的文档
GET kibana_sample_data_logs/_search?q=message:chrome

# 匹配字段message包含chrome或firefox的文档
GET kibana_sample_data_logs/_search?q=message:chrome firefox
```



#### 1.2 基于请求体

```json
# 匹配字段DestCountry包含CN的文档
GET kibana_sample_data_flights/_search
{
  "query": {
    "term": {
      "DestCountry": "CN"
    }
  }
}
```

```json
# 参数match_all匹配所有文档
GET kibana_sample_data_logs/_search
{
  "query": {"match_all": {}}
}
```

```json
# 参数match_none不匹配文档
GET kibana_sample_data_logs/_search
{
  "query": {"match_none":{}}
}
```



### 2 分页

#### 2.1 from与size参数

from参数：代表检索文档的起始位置，默认值为0。

size参数：代表每次检索文档的总量，默认值为10。

- from和size参数和不能超过index.max_result_windows配置值，该值默认值为10000。



#### 2.2 scroll参数

scroll参数：一种类似数据库游标的文档遍历机制，使用步骤，第一创建游标，第二对游标遍历。

scroll参数只能在URI中使用，在超时后自动删除。

使用场景如：

- 将一个索引中的文档导入到另一个索引中；
- 将索引文档导入到mysql中。

```json
# 创建游标
POST kibana_sample_data_logs/_search?scroll=2m&size=1000
{
  "query": {
    "term": {
      "message": "chrome"
      }
    }
}
```

```json
# 根据游标ID检索文档
POST _search/scroll
{
  "scroll": "2m",
  "scroll_id": "DXF1ZXJ5QW5kRmV0Y2gBAAAAAAAAB48WTkZZeE14anBRZ09vUWJTQzRTMlpTdw=="
}
```



### 3 排序

sort参数

```json
# _score按文档相似度得分排序
POST kibana_sample_data_flights/_search
{
  "sort":[
    "AvgTicketPrice",
    "_score"
    ]
}
```

```json
# mode按最大值排序
POST kibana_sample_data_ecommerce/_search
{
  "sort": [
    {
      "products.base_price": {
        "order":"desc",
        "mode":"max"
      }
    }
  ]
}
```



### 4 字段投影

```json
# 只返回DestCountry字段文档
POST kibana_sample_data_flights/_search
{
  "_source": "DestCountry"
}
```



### 5 其他接口

_count接口

_msearch接口

_scripts接口

_validate接口

_explain接口

_field_caps接口

