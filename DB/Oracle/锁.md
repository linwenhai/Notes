



#### 1 查询是否有死锁

```sql
select username,lockwait,status,machine,program from v$session where sid in
(select session_id from v$locked_object)
```

如果有输出的结果，则说明有死锁，且能看到死锁的机器是哪一台。

Username：死锁语句所用的数据库用户。
Lockwait：死锁的状态，如果有内容表示被死锁。
Status： 状态，active表示被死锁。
Machine： 死锁语句所在的机器。
Program： 产生死锁的语句主要来自哪个应用程序。



#### 2 查看到被死锁的SQL

```sql
select sql_text from v$sql where hash_value in 
(select sql_hash_value from v$session where sid in
(select session_id from v$locked_object))
```



### 3 查找死锁的进程

```sql
SELECT s.username,l.OBJECT_ID,l.SESSION_ID,s.SERIAL#,
l.ORACLE_USERNAME,l.OS_USER_NAME,l.PROCESS 
FROM V$LOCKED_OBJECT l,V$SESSION S WHERE l.SESSION_ID=S.SID;
```



#### 4 kill掉这个死锁的进程

```sql
alter system kill session ‘sid,serial#’; 
---（其中sid=l.session_id）
```



#### 5 如果还不能解决,kill掉OS进程

```sql
select p.spid from v$session s,v$process p
where s.sid=XX and s.paddr=p.addr;
```

ps -ef|grep spid







```sql
select sess.sid,
       sess.serial#,
       vp.SPID,
       lo.oracle_username,
       lo.os_user_name,
       ao.object_name,
       lo.locked_mode,
       'alter system kill session '||''''||sess.SID||','||sess.SERIAL#||''''||';'
  from v$locked_object lo, dba_objects ao, v$session sess, v$process vp
 where ao.object_id = lo.object_id
   and lo.session_id = sess.sid
   and sess.PADDR = vp.ADDR;
```















