## 常用命令

### 1 zip

| 参数 | 描述                                             |
| ---- | ------------------------------------------------ |
| r    | 递归处理，将指定目录下的所有文件和子目录一并处理 |

```shell
# 将/app/html这个目录下所有文件和文件夹打包为当前目录下的 html.zip
zip -r html.zip /app/html

# 如在/app/html目录下，可以执行以下命令
zip -r html.zip *
```

```shell
# 解压
unzip html.zip
```



### 2 rz/sz

```shell
yum install lrzsz
```

```shell
# 上传文件
rz
```

```shell
# 下载文件
sz 1.log
```





### 3 date

```shell
# 获取系统时间
date "+%Y-%m-%d %H:%M:%S"
```

>执行结果：
>
>2020-08-18 13:53:21



### 4 curl

```shell
# 获取网站http状态码
curl -o /dev/null -s -w "http_code:%{http_code}\n" http://www.baidu.com
```



```shell
# 上传文件到FTP服务器
curl -u 835084:123456 -T 1.txt ftp://10.1.1.11/
```

```shell
# 下载FTP服务器文件
curl -u 835084:123456 ftp://10.1.1.11/logback.xml -o logback.xml
```



### 5 crontab

```shell
crontab -l
crontab -e
```

```shell
# 语法
*    *    *    *    *    /bin/ls
-    -    -    -    -
|    |    |    |    |
|    |    |    |    +----- 星期中星期几 (0 - 7) (星期天 为0)
|    |    |    +---------- 月份 (1 - 12) 
|    |    +--------------- 一个月中的第几天 (1 - 31)
|    +-------------------- 小时 (0 - 23)
+------------------------- 分钟 (0 - 59)
```

```shell
# 每10s执行一次
* * * * * sh test.sh
* * * * * sleep 10; sh test.sh
* * * * * sleep 20; sh test.sh
* * * * * sleep 30; sh test.sh
* * * * * sleep 40; sh test.sh
* * * * * sleep 50; sh test.s
```

```shell
# 每分钟执行一次
* * * * * sh test.sh
```



### 6 grep

| 参数选项 | 含义                             |
| :------- | :------------------------------- |
| -v       | 显示不包含匹配“info”文本的所有行 |
| -n       | 显示匹配行及行号                 |
| -i       | 忽略大小写                       |
| -r       | 递归搜索，包含当前目录和子目录   |
| ^m       | 搜寻以m开头的行                  |
| e$       | 搜寻以 e 结束的行                |







### 7 find

| 常用用法                               | 含义                                   |
| :------------------------------------- | :------------------------------------- |
| find /tmp -name test.sh                | 查找/tmp目录下所有名为test.sh的文件    |
| find /tmp -name '*.sh'                 | 查找/tmp目录下所有后缀为.sh的文件      |
| find /tmp -name "[A-Z]*"               | 查找/tmp目录下所有以大写字母开头的文件 |
| find /tmp -size 2M                     | 查找/tmp 目录下等于2M的文件            |
| find /tmp -size +2M                    | 查找/tmp 目录下大于2M的文件            |
| find /tmp -size -2M                    | 查找/tmp 目录下小于2M的文件            |
| find /tmp -size +4k -size -5M          | 查找/tmp目录下大于4k，小于5M的文件     |
| find /tmp -perm 777                    | 查找/tmp目录下权限为 777 的文件或目录  |
| find /tmp -type f -mtime +7            | 查找/tmp目录下7天前文件                |
| find /tmp -name "*.log" -exec rm {} \; | 删除/tmp目录下所有log文件              |



### 8 tar

```shell
# tar归档管理，扩展名是xxxx.tar，语法
tar [参数] [打包文件名] [文件]
```

| 参数 | 含义                                                      |
| :--- | :-------------------------------------------------------- |
| -c   | 打包档案文件                                              |
| -v   | 列出归档解档的详细过程，显示进度                          |
| -f   | 指定档案文件名称，f后面一定是.tar文件，所以必须放选项最后 |
| -t   | 列出档案中包含的文件                                      |
| -x   | 解开档案文件                                              |

```shell
# 打包文件
tar -cvf 1.tar 1.log
 
# 解压文件
tar -xvf 1.tar
```

```shell
# 在tar命令中增加一个选项(-z)可以调用gzip实现了一个压缩的功能
tar -zcvf 1.tar.gz 1.log
 
# 解压文件
tar -zxvf 1.tar.gz
```



### 9 gzip

```shell
# gzip文件压缩解压，扩展名是xxxx.gz，语法
gzip  [选项]  [被压缩文件]
```

| 参数 | 含义                 |
| :--- | :------------------- |
| -d   | 解压                 |
| -r   | 递归，压缩所有子目录 |

```shell
# 压缩文件
gzip -r 1.tar 1.tar.gz
 
# 解压文件
gzip -d 1.tar.gz
```



### 10 bzip

```shell
# 压缩用法：tar -jcvf 压缩包包名 文件
tar -jcvf 1.tar.bz2 *.c
 
# 解压用法：tar -jxvf 压缩包包名
tar -jxvf 1.tar.bz2
```



### 11 wget

wget参数：

- -O : 下载并以不同的文件名保存
- --spider : 模拟下载，不会下载，只是会检查是否网站是否好着

```shell
# 下载文件，将文档写入FILE（重命名）
wget -O [newname] [URL]
```

```shell
wget --spider http://www.baidu.com
```





### 12 awk

语法：awk '{pattern + action}' {filenames}

- pattern：表示awk在数据中查找的内容。
- action：  是在找到匹配内容时所执行的一系列命令。
- $0：则表示所有域，$1表示第一个域，$n表示第n个域。
- -F：指定域分隔符为':'，默认每行按空格或TAB分割。

```shell
# 以冒号作为分隔符，打印第2域内容
awk -F ':' '{print $2}' 1.log
```

```shell
# 使用if判断语句
awk '{if ($12 > 1000) print $0}' access.log|more
```



### 13 sort

**sort**将文件的每一行作为一个单位，相互比较，比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。

- -b : 忽略每行前面开始出的空格字符
- -c : 检查文件是否已经按照顺序排序

- -d : 排序时，处理英文字母、数字及空格字符外，忽略其他的字符

- -f : 排序时，将小写字母视为大写字母

- -i : 排序时，除了040至176之间的ASCII字符外，忽略其他的字符

- -m : 将几个排序号的文件进行合并

- -M : 将前面3个字母依照月份的缩写进行排序

- -n : 依照数值的大小排序

- -o : 将排序后的结果存入制定的文件

- -r : 以相反的顺序来排序
- -t : 指定排序时所用的栏位分隔字符



### 14 uniq

uniq 命令用于报告或忽略文件中的重复行，一般与sort命令结合使用。

```shell
# sort -nr按数值倒排，uniq -c 去重
cat access.log|awk '{print $4}'|uniq -c|sort -nr|head -n 10
```



### 15 sed

| 用法                                        | 含义                              |
| ------------------------------------------- | --------------------------------- |
| sed -n '2p' error.log                       | 显示文件第2行                     |
| sed -n '1,3p' error.log                     | 显示文件第1行到第3行              |
| sed -n '/sfpay/p' error.log                 | 显示匹配sfpay的行                 |
| sed -n '/2019\/04\/19 03:50:55/p' error.log | 使用转义符                        |
| sed -n '/03:29:59/,/03:57:16/p' error.log   | 显示'/起始时间/,/结束时间/p' 的行 |

```shell
# 替换字符串，分隔符为"#"
sed -i 's#/etc/logs/access.log#/app/logs/access.log#' filebeat.yml
```



### 16 split

split语法：

- -l : 按输出文件行数。
- -b : 按输出文件大小
- -d : 后缀为数字，默认为字母
- -a : 默认为2，意思是后缀的位数

```shell
# 切割csv文件，切割后文件名为nc_**
split -l 100000 nc.csv -d nc_
```



### 17 xargs

xargs的默认命令是echo，空格是默认定界符，默认替换符号是{}。

xargs命令每次只获取一部分文件而不是全部。

```shell
# 删除当前目录下的log文件
ls *.log|xargs rm -rf {}
```

```shell
# kill掉haproxy进程
ps -ef|grep haproxy|awk '{print $2}'|xargs kill -9 {}
```



### 18 scp

ssh scp等消除每次问yes/no方法

```shell
vi /etc/ssh/ssh_config
```

```shell
#  StrictHostKeyChecking ask 改成 no
StrictHostKeyChecking no
```



### 19 tcpdump

```shell
# 监视所有送到主机hostname的数据包
tcpdump -i ens33 dst host 192.168.198.11 >/tmp/1.log
```



```shell
# 截获主机hostname发送的所有数据
tcpdump -i ens33 src host 192.168.198.11 >/tmp/1.log
```



### 20 top

```shell
top		# 查看OS所有进程状态
top -Hp <PID>		# 查看单个进程各个线程状态
```

